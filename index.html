<!DOCTYPE html>
<html>
<head>
    <title>Affiliates Currency Manager</title>
    <style>
        .options-row {
            margin-bottom: 10px;
        }
        .option-label {
            margin-right: 20px;
        }
    </style>
    <script>
        // Function to remove specified currencies
        const removeCurrencies = (data, currencies) => {
            Object.keys(data).forEach(key => {
                if(data[key].hasOwnProperty('supported_digital_currencies')) {
                    data[key].supported_digital_currencies = data[key].supported_digital_currencies.filter(currency => !currencies.includes(currency));
                }
            });
            return data;
        };

        // Function to add specified currencies
        const addCurrencies = (data, currencies) => {
            Object.keys(data).forEach(key => {
                if(data[key].hasOwnProperty('supported_digital_currencies') && data[key].probability > 0) {
                    data[key].supported_digital_currencies = [...new Set([...data[key].supported_digital_currencies, ...currencies])];
                }
            });
            return data;
        };

        // Function to handle form submission
function handleSubmit(event) {
    event.preventDefault();
    const affiliatesInput = document.getElementById('affiliates').value;
    const removeChecked = document.getElementById('removeChecked').checked;
    const addChecked = document.getElementById('addChecked').checked;

    try {
        let affiliates = JSON.parse(affiliatesInput);
        const currenciesToRemove = removeChecked ? JSON.parse(document.getElementById('currenciesToRemove').value) : [];
        const currenciesToAdd = addChecked ? JSON.parse(document.getElementById('currenciesToAdd').value) : [];

        if (removeChecked) {
            affiliates = removeCurrencies(affiliates, currenciesToRemove);
        }
        if (addChecked) {
            affiliates = addCurrencies(affiliates, currenciesToAdd);
        }

        document.getElementById('result').textContent = JSON.stringify(affiliates, null, 2);
    } catch (e) {
        document.getElementById('result').textContent = 'Invalid input. Please enter valid JSON for all fields.';
    }
}


// Function to copy result text to clipboard
function copyResult() {
    const resultText = document.getElementById('result').textContent;
    navigator.clipboard.writeText(resultText).then(() => {
        alert('Result copied to clipboard!');
    }).catch(err => {
        console.error('Failed to copy result:', err);
        alert('Failed to copy result. Please try again.');
    });
}


        // Function to toggle input fields based on checkbox state
        function toggleInputFields() {
            const removeChecked = document.getElementById('removeChecked').checked;
            const addChecked = document.getElementById('addChecked').checked;
            document.getElementById('currenciesToRemove').disabled = !removeChecked;
            document.getElementById('currenciesToAdd').disabled = !addChecked;
        }
    </script>
</head>
<body>
    <h2>Affiliates Currency Manager</h2>
    <div class="options-row">
        <input type="checkbox" id="removeChecked" checked onchange="toggleInputFields()">
        <label class="option-label" for="removeChecked">Remove Currencies</label>
        <input type="checkbox" id="addChecked" checked onchange="toggleInputFields()">
        <label class="option-label" for="addChecked">Add Currencies</label>
    </div>
    <form onsubmit="handleSubmit(event)">
        <label for="affiliates">Affiliates (JSON):</label><br>
        <textarea id="affiliates" rows="10" cols="50"></textarea><br>
        <label for="currenciesToRemove">Currencies to Remove (JSON Array):</label><br>
        <textarea id="currenciesToRemove" rows="3" cols="50"></textarea><br>
        <label for="currenciesToAdd">Currencies to Add (JSON Array):</label><br>
        <textarea id="currenciesToAdd" rows="3" cols="50"></textarea><br><br>
        <input type="submit" value="Update Currencies">
    </form>
    <h3>Result:</h3>
    <button onclick="copyResult()">Copy Result</button>
    <pre id="result"></pre>
    <script>
        // Initialize input fields based on checkbox state
        toggleInputFields();
    </script>
</body>
</html>
